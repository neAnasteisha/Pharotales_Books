"Початок роботи:"
"1. Очищення колекції"
TaleCollection clearAll.

"Додавання книг через діалогове вікно"
"TaleCollection newFromDialog." "----------------------- Для використання варто розкоментувати"

"Додавання книг"

tale1 := TaleCollection new
    author: 'Ганс Крістіан Андерсен';
    title: 'Гидке каченя';
    publicationYear: 1852;
    pagesPerVolume: #(120 95 140);
    yourself.
TaleCollection add: tale1.

tale2 := TaleCollection new
    author: 'Вільгельм та Якоб Грімм';
    title: 'Рапунцель';
    publicationYear: 1812;
    pagesPerVolume: #(200 185 210 195);
    yourself.
TaleCollection add: tale2.

tale3 := TaleCollection new
    author: 'Ганс Крістіан Андерсен';
    title: 'Дюймовочка';
    publicationYear: 1845;
    pagesPerVolume: #(150 180);
    yourself.
TaleCollection add: tale3.

tale4 := TaleCollection new
    author: 'Шарль Перро';
    title: 'Попелюшка';
    publicationYear: 1697;
    pagesPerVolume: #(250);
    yourself.
TaleCollection add: tale4.

book1 := StoryBook new
    author: 'Редьярд Кіплінг';
    title: 'Книга джунглів';
    publisher: 'Класика';
    publicationYear: 1894;
    pages: 180;
    illustrations: 25;
    yourself.

book2 := StoryBook new
    author: 'Ганс Крістіан Андерсен';
    title: 'Снігова королева';
    publisher: 'Дитяча література';
    publicationYear: 1844;
    pages: 95;
    illustrations: 40;
    yourself.

"Виведення всіх книг"
Transcript cr; show: '=== Список доданих книг: ==='; cr.
TaleCollection listToTranscript.

"============================================
(Знайдіть найбільшу за обсягом книгу. Чи це багатотомник?)
  2.  Знаходження найбільшої за обсягом книги та перевірка на багатотомність (не впевнена чи це слово існує)
============================================"
"| allTales maxTale |"
allTales := TaleCollection all.
maxTale := allTales inject: allTales first into: [ :max :current |
    current totalPages > max totalPages
        ifTrue: [ current ]
        ifFalse: [ max ] ].

Transcript cr; show: '=== Найбільша за обсягом книга: ==='; cr.
Transcript show: 'Назва: ', maxTale title; cr.
Transcript show: 'Автор: ', maxTale author; cr.
Transcript show: 'Кількість сторінок: ', maxTale totalPages printString; cr.
Transcript show: 'Це багатотомник? ', (maxTale volumes > 1 ifTrue: ['Так'] ifFalse: ['Ні']); cr.
Transcript show: 'Кількість томів: ', maxTale volumes printString; cr.

"============================================
(Продемонструйте використання арифметичних операторів)
  3. Демонстрація арифмеичних операторів
============================================"
Transcript cr; show: '=== Арифметичні операції з книгами ==='; cr.

"Додавання та віднімання сторінок"
Transcript show: 'Сторінок у tale1: ', tale1 totalPages printString; cr.
Transcript show: 'Сторінок у tale2: ', tale2 totalPages printString; cr.
Transcript show: 'Разом сторінок: ', (tale1 totalPages + tale2 totalPages) printString; cr.
Transcript show: 'Різниця: ', (tale2 totalPages - tale1 totalPages) printString; cr.

"Множення та ділення"
Transcript cr.
Transcript show: 'Якщо надрукувати tale1 у 100 примірниках: ', 
    (tale1 totalPages * 100) printString, ' сторінок'; cr.
Transcript show: 'Середня кількість сторінок на том у tale2: ',
    (tale2 totalPages / tale2 volumes) printString; cr.

"Порівняння книг (оператор <)"
Transcript cr; show: '=== Порівння книг оператором "<" ==='; cr.
Transcript show: 'tale1 < tale2: ', (tale1 < tale2) printString; cr.
Transcript show: 'tale3 < tale1: ', (tale3 < tale1) printString; cr.

"============================================
(Створіть нову колекцію, що містить книги певного автора.)
  4. Створення колекції книг певного автора
============================================"
"| andersenBooks |"
andersenBooks := allTales select: [ :tale | 
    (tale author includesSubstring: 'Ганс Крістіан Андерсен') or: 
    [ tale author includesSubstring: 'Hans Christian Andersen' ] ].

Transcript cr; show: '=== Книги Ганса Крістіана ==='; cr.
Transcript show: 'Знайдено книг: ', andersenBooks size printString; cr.
andersenBooks do: [ :tale |
    Transcript show: '- ', tale title, ' (', tale publicationYear printString, 
        ', томів: ', tale volumes printString, ')'; cr ].

"Статистика книг автора"
"| totalPagesAndersen totalVolumes |"
totalPagesAndersen := andersenBooks inject: 0 into: [ :sum :tale | 
    sum + tale totalPages ].
totalVolumes := andersenBooks inject: 0 into: [ :sum :tale | 
    sum + tale volumes ].

Transcript cr.
Transcript show: 'Загальна статистика:'; cr.
Transcript show: '  Всього книг: ', andersenBooks size printString; cr.
Transcript show: '  Всього томів: ', totalVolumes printString; cr.
Transcript show: '  Всього сторінок: ', totalPagesAndersen printString; cr.
Transcript show: '  Середньо сторінок на книгу: ', 
    (totalPagesAndersen / andersenBooks size) rounded printString; cr.

"============================================
(Продемонструйте зберігання створених об’єктів до файлу (до різних файлів у різних форматах), та завантаження їх з файлу.)
  5. Збереження та завантаження з файлу
============================================"

"Збереження у форматі FUEL (бінарний формат Pharo)"
Transcript cr; show: '=== Збереження у різних форматах ==='; cr.

"| fuelFile |"
fuelFile := 'tales_collection.fuel' asFileReference.
FLSerializer serialize: TaleCollection all toFileNamed: fuelFile fullName.
Transcript show: 'Збережено у форматі FUEL: ', fuelFile fullName; cr.

"Збереження у форматі STON"
"| stonFile |"
stonFile := 'tales_collection.ston' asFileReference.
stonFile writeStreamDo: [ :stream |
    STON put: TaleCollection all onStream: stream ].
Transcript show: 'Збережено у форматі STON: ', stonFile fullName; cr.

"Збереження у текстовий CSV формат"
"| csvFile |"
csvFile := 'tales_report.csv' asFileReference.
csvFile writeStreamDo: [ :stream |
    stream nextPutAll: 'Автор, Назва, Рік, Томів, Сторінок, Аркушів'; cr.
    TaleCollection all do: [ :tale |
        stream 
            nextPutAll: tale author; nextPut: $,;
            nextPutAll: tale title; nextPut: $,;
            nextPutAll: tale publicationYear printString; nextPut: $,;
            nextPutAll: tale volumes printString; nextPut: $,;
            nextPutAll: tale totalPages printString; nextPut: $,;
            nextPutAll: (tale printedSheets printShowingDecimalPlaces: 2); cr ] ].
Transcript show: 'Збережено у форматі CSV: ', csvFile fullName; cr.
"============================================
  6. Завантаження з файлів
============================================"
Transcript cr; show: '=== Завантаження з файлів ==='; cr.

TaleCollection clearAll.
Transcript show: 'Колекція очищена. Розмір: ', TaleCollection all size printString; cr.

"Завантаження з файлу FUEL"
"| loadedFromFuel |"
loadedFromFuel := FLMaterializer materializeFromFileNamed: fuelFile fullName.
loadedFromFuel do: [ :tale | TaleCollection add: tale ].
Transcript show: 'Завантажено з файлу FUEL: ', loadedFromFuel size printString, ' книг'; cr.

"Завантаження з файлу STON"
TaleCollection clearAll.
"| loadedFromSton |"
stonFile readStreamDo: [ :stream |
    loadedFromSton := STON fromStream: stream ].
loadedFromSton do: [ :tale | TaleCollection add: tale ].
Transcript show: 'Завантажено з файлу STON: ', loadedFromSton size printString, ' книг'; cr.

"Завантаження з файлу CSV"
csvFile readStreamDo: [ :stream |
    | lineCount |
    lineCount := 0.
    [ stream atEnd ] whileFalse: [
        lineCount := lineCount + 1.
        lineCount <= 5 ifTrue: [ Transcript show: stream nextLine; cr ] ] ].

"============================================
  7. Загальна статистика
============================================"
Transcript cr; show: '=== Загальна статистика казок ==='; cr.
Transcript show: 'Всього книг у колекції: ', TaleCollection all size printString; cr.
Transcript show: 'Загальна кількість томів: ', 
    (TaleCollection all inject: 0 into: [ :sum :tale | sum + tale volumes ]) printString; cr.
Transcript show: 'Загальна кількість сторінок: ',
    (TaleCollection all inject: 0 into: [ :sum :tale | sum + tale totalPages ]) printString; cr.
Transcript show: 'Середня кількість томів на книгу: ',
    ((TaleCollection all inject: 0 into: [ :sum :tale | sum + tale volumes ]) / 
        TaleCollection all size) rounded printString; cr.

Transcript cr; show: '=== Кінець. Далі буде... ==='; cr.
